name: Test and update version

on:
  push:
    branches:
      - main
    paths:
      - 'emod_api/**'
      - 'pyproject.toml'

  # Allows manual run from the Actions tab
  workflow_dispatch:

permissions:
  contents: write # Allow writing to the repository (e.g., commits, pushes)

jobs:
  run-tests:
    name: Run tests
    uses: ./.github/workflows/tests_all.yml

  bump-version:
    name: Bump patch version
    runs-on: ubuntu-latest
    needs:
      - run-tests
    steps:
      - name: Bump version
        uses: callowayproject/bump-my-version@v1
        with:
          args: patch -vv
